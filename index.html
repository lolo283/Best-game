<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EarthLike v2</title>
  <style>
    :root {
      --bg:#0b1220;--card:#121a2b;--accent:#4f46e5;--text:#e5e7eb;
      --muted:#94a3b8;--success:#22c55e;--danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Arial,sans-serif;background:radial-gradient(1200px 600px at 80% -10%,#1f2a44 0%,transparent 60%),var(--bg);color:var(--text)}
    header{position:sticky;top:0;backdrop-filter:blur(10px);background:rgba(11,18,32,.7);border-bottom:1px solid #1f2a44;padding:12px 16px;display:flex;gap:12px;z-index:10}
    .logo{font-weight:900}
    .pill{padding:6px 10px;border-radius:999px;background:#1f2a44;color:var(--muted);font-size:12px}
    main{padding:16px;max-width:980px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
    .card{background:linear-gradient(180deg,#0f1730,#0b1220);border:1px solid #1f2a44;border-radius:14px;padding:14px;box-shadow:0 10px 20px rgba(0,0,0,.25)}
    h1{margin:8px 0 12px;font-size:22px}
    h2{margin:6px 0 10px;font-size:16px}
    .stat{font-size:28px;font-weight:800}
    .btn{width:100%;border:0;border-radius:10px;padding:10px 12px;background:linear-gradient(135deg,#6366f1,#22d3ee);color:#020617;font-weight:800;cursor:pointer}
    .btn.secondary{background:#1f2a44;color:var(--text)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .mini{font-size:12px;color:var(--muted)}
    .game{display:none}
    .game.active{display:block}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #1f2a44;background:#0b1220;color:var(--text)}
    footer{padding:24px 16px;color:var(--muted);text-align:center}
  </style>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>
    <div class="logo">EarthLike v2</div>
    <span class="pill">Mini-jeux</span>
    <span class="pill">Niveaux & dÃ©fis</span>
    <span class="pill">Classement global</span>
  </header>

  <main>
    <h1>Dashboard</h1>
    <div class="grid">
      <div class="card">
        <h2>ğŸ’° Points</h2>
        <div class="stat"><span id="coins">0</span></div>
        <p class="mini">Monnaie virtuelle</p>
      </div>
      <div class="card">
        <h2>ğŸ“ˆ Niveau</h2>
        <div class="stat">Niv. <span id="level">1</span></div>
        <p class="mini">XP: <span id="xp">0</span> / <span id="xpMax">50</span></p>
      </div>
      <div class="card">
        <h2>ğŸ® Mini-jeux</h2>
        <div class="row">
          <button class="btn secondary" onclick="openGame('clicker')">Clicker</button>
          <button class="btn secondary" onclick="openGame('guess')">Devine</button>
        </div>
        <p class="mini">Joue pour gagner des points</p>
      </div>
      <div class="card">
        <h2>ğŸ“… DÃ©fi du jour</h2>
        <p id="dailyChallenge" class="mini"></p>
        <button class="btn secondary" id="claimDaily">RÃ©cupÃ©rer</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>ğŸ Coffre surprise</h2>
        <button class="btn" id="openChest">Ouvrir le coffre</button>
        <p class="mini" id="chestInfo"></p>
      </div>
      <div class="card">
        <h2>ğŸ… SuccÃ¨s</h2>
        <ul id="badges" class="mini"></ul>
      </div>
    </div>

    <!-- Jeux -->
    <div class="card game" id="clicker">
      <h2>âš¡ Clicker (10 secondes)</h2>
      <p class="mini">+1 point par clic</p>
      <button class="btn" id="clickBtn">Clique !</button>
      <p>Score: <b id="clickScore">0</b> â€” Temps: <b id="time">10</b>s</p>
      <button class="btn secondary" onclick="startClicker()">DÃ©marrer</button>
    </div>

    <div class="card game" id="guess">
      <h2>ğŸ¯ Devine le nombre (5â€“10)</h2>
      <input id="guessInput" type="number" placeholder="Entre un nombre 5â€“10" />
      <div class="row">
        <button class="btn" onclick="playGuess()">Tester</button>
        <button class="btn secondary" onclick="newSecret()">Nouveau nombre</button>
      </div>
      <p id="guessResult" class="mini"></p>
    </div>

    <!-- Classement -->
    <div class="card">
      <h2>ğŸ† Classement global</h2>
      <input id="username" placeholder="Ton pseudo (unique)" />
      <div class="row">
        <button class="btn" onclick="sendScore()">Envoyer mes points</button>
        <button class="btn secondary" onclick="loadLeaderboard()">Actualiser</button>
      </div>
      <ol id="globalLeaderboard" class="mini"></ol>
    </div>
  </main>

  <footer>Projet perso â€“ EarthLike v2</footer>

  <script>
  // ===== Firebase (TA vraie config) =====
  const firebaseConfig = {
    apiKey: "AIzaSyD8BD2CGj3UBqjZXBB8DrMJcu5RUj5yqmg",
    authDomain: "escape-tsunami.firebaseapp.com",
    projectId: "escape-tsunami",
    storageBucket: "escape-tsunami.firebasestorage.app",
    messagingSenderId: "810267064841",
    appId: "1:810267064841:web:0fe4106f6d4740dd9b56d8"
  };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ===== State =====
    let coins = Number(localStorage.getItem("coins") || 0);
    let xp = Number(localStorage.getItem("xp") || 0);
    let level = Number(localStorage.getItem("level") || 1);
    let xpMax = level * 50;

    const $ = id => document.getElementById(id);
    function save() {
      localStorage.setItem("coins", coins);
      $("coins").innerText = coins;
      checkBadges();
    }

    function updateLevelUI() {
      $("level").innerText = level;
      $("xp").innerText = xp;
      $("xpMax").innerText = xpMax;
    }
    function addXP(n) {
      xp += n;
      if (xp >= xpMax) {
        xp -= xpMax;
        level++; xpMax = level * 50;
        alert("ğŸ‰ Niveau " + level + " dÃ©bloquÃ© !");
      }
      localStorage.setItem("xp", xp);
      localStorage.setItem("level", level);
      updateLevelUI();
    }

    $("coins").innerText = coins; updateLevelUI();

    function openGame(id){
      document.querySelectorAll('.game').forEach(g=>g.classList.remove('active'));
      $(id).classList.add('active');
      window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
    }

    // ===== Clicker =====
    let clickScore=0,timeLeft=10,timer=null;
    $("clickBtn").onclick=()=>{ if(timeLeft>0){ clickScore++; $("clickScore").innerText=clickScore; } };
    function startClicker(){
      if(timer) return;
      clickScore=0; timeLeft=10; $("clickScore").innerText=0; $("time").innerText=10;
      timer=setInterval(()=>{
        timeLeft--; $("time").innerText=timeLeft;
        if(timeLeft<=0){
          clearInterval(timer); timer=null;
          coins+=clickScore; addXP(5); save();
          alert("Fini ! +" + clickScore + " points ğŸ‰");
        }
      },1000);
    }

    // ===== Guess =====
    let secret=Math.floor(Math.random()*10)+1;
    function newSecret(){ secret=Math.floor(Math.random()*10)+1; $("guessResult").innerText="Nouveau nombre ğŸ‘€"; }
    function playGuess(){
      const g=Number($("guessInput").value);
      if(!g||g<1||g>10) return;
      if(g===secret){ coins+=10; addXP(10); save(); $("guessResult").innerText="Bravo ! +10 points ğŸ‰"; newSecret(); }
      else $("guessResult").innerText="RatÃ© ğŸ˜…";
    }

    // ===== DÃ©fi du jour =====
    const challenges=["Fais 20 clics au Clicker","Gagne une fois au Devine","Atteins +30 points aujourdâ€™hui"];
    const todayKey=new Date().toDateString();
    $("dailyChallenge").innerText=challenges[new Date().getDate()%challenges.length];
    $("claimDaily").onclick=()=>{
      if(localStorage.getItem("dailyDone")==todayKey) return alert("DÃ©jÃ  rÃ©cupÃ©rÃ© aujourdâ€™hui ğŸ˜…");
      coins+=20; addXP(10); save();
      localStorage.setItem("dailyDone",todayKey);
      alert("ğŸ +20 points et +10 XP !");
    };

    // ===== Coffre =====
    $("openChest").onclick=()=>{
      const reward=Math.floor(Math.random()*50)+1;
      coins+=reward; addXP(5); save();
      $("chestInfo").innerText="ğŸ‰ Tu as gagnÃ© "+reward+" points !";
    };

    // ===== Badges =====
    function checkBadges(){
      const list=$("badges"); list.innerHTML="";
      if(coins>=1000) list.innerHTML+="<li>ğŸ¥‰ 1000 points</li>";
      if(coins>=5000) list.innerHTML+="<li>ğŸ¥ˆ 5000 points</li>";
      if(coins>=10000) list.innerHTML+="<li>ğŸ¥‡ 10000 points</li>";
    }
    checkBadges();

    // ===== Classement =====
    async function sendScore(){
      const name=$("username").value.trim();
      if(!name) return alert("Entre un pseudo");
      await db.collection("leaderboard").doc(name).set({name,points:coins,updatedAt:Date.now()});
      loadLeaderboard(); alert("Score envoyÃ© ğŸŒ");
    }
    async function loadLeaderboard(){
      const snap=await db.collection("leaderboard").orderBy("points","desc").limit(10).get();
      const list=$("globalLeaderboard"); list.innerHTML="";
      snap.forEach(doc=>{ const d=doc.data(); const li=document.createElement("li"); li.textContent=`${d.name} â€” ${d.points} points`; list.appendChild(li); });
    }
    loadLeaderboard();
  </script>
</body>
</html>